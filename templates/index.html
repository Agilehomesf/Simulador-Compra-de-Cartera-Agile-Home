<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Compra de Cartera Hipotecaria - Agile Home</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="row align-items-center justify-content-center text-center">
    <div class="col-lg-10">
                    <h1 class="header-title">
                        <i class="bi bi-house-door me-3"></i>
                        Simulador de Compra de Cartera Hipotecaria
                    </h1>
                    <p class="header-subtitle">
                        Descubre cuánto puedes ahorrar al trasladar tu hipoteca a otro banco
                    </p>
                </div>
                <div class="col-lg-4 text-lg-end">
                    <i class="house-icon-large bi bi-house-heart"></i>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container my-5">
        <!-- Introduction Section -->
        <div class="intro-container">
            <div class="row justify-content-center">
                <div class="col-lg-10 text-center">
                    <h2><i class="bi bi-lightbulb me-2"></i>¿Cómo funciona la Compra de Cartera?</h2>
                    <p class="lead">Transfiere tu hipoteca actual a un nuevo banco con mejores condiciones y ahorra dinero cada mes.</p>
                    
                    <div class="row mt-4">
                        <div class="col-md-4 text-center mb-3">
                            <div class="intro-icon">
                                <i class="bi bi-calculator"></i>
                            </div>
                            <h5>Calcula tu ahorro</h5>
                            <p class="small">Compara las condiciones actuales vs las nuevas ofertas del mercado</p>
                        </div>
                        <div class="col-md-4 text-center mb-3">
                            <div class="intro-icon">
                                <i class="bi bi-bank"></i>
                            </div>
                            <h5>Múltiples bancos</h5>
                            <p class="small">Compara ofertas de los principales bancos del país</p>
                        </div>
                        <div class="col-md-4 text-center mb-3">
                            <div class="intro-icon">
                                <i class="bi bi-piggy-bank"></i>
                            </div>
                            <h5>Ahorra dinero</h5>
                            <p class="small">Reduce tu cuota mensual y ahorra miles de pesos</p>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <i class="house-icon-large bi bi-house-heart"></i>
                </div>
            </div>
        </div>

        <!-- Calculator Form -->
        <div class="card">
            <div class="card-header">
                <h3 class="mb-0">
                    <i class="bi bi-calculator me-2"></i>
                    Datos de tu Hipoteca Actual
                </h3>
            </div>
            <div class="card-body">
                <form id="calculatorForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="property_value" class="form-label">Valor del Inmueble</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="text" class="form-control currency-input" id="property_value" name="property_value" 
                                           placeholder="500,000,000" required>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="portfolio_balance" class="form-label">Saldo de la Cartera a Comprar</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="text" class="form-control currency-input" id="portfolio_balance" name="portfolio_balance" 
                                           placeholder="134,000,000" required>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="initial_term" class="form-label">Plazo Inicial de la Deuda (meses)</label>
                                <input type="number" class="form-control" id="initial_term" name="initial_term" 
                                       placeholder="240" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="remaining_term" class="form-label">Plazo Restante (meses)</label>
                                <input type="number" class="form-control" id="remaining_term" name="remaining_term" 
                                       placeholder="154" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="current_payment" class="form-label">Cuota Actual que Paga (incluye seguros)</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="text" class="form-control currency-input" id="current_payment" name="current_payment" 
                                           placeholder="2,800,000" required>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="current_rate" class="form-label">Tasa Efectiva Anual Actual (%)</label>
                                <input type="number" class="form-control" id="current_rate" name="current_rate" 
                                       step="0.01" placeholder="13.50" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="insurance_value" class="form-label">Valor de Seguros (referencia)</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="text" class="form-control currency-input" id="insurance_value" name="insurance_value" 
                                           placeholder="350,000" required>
                                </div>
                                <div class="form-text text-muted small">
                                    <i class="bi bi-info-circle me-1"></i>
                                    Base de referencia para calcular seguros en nuevas cuotas
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="new_term" class="form-label">Plazo Deseado para la Compra de Cartera (meses)</label>
                                <input type="number" class="form-control" id="new_term" name="new_term" 
                                       placeholder="180" required>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Bank Selection -->
        <div class="card">
            <div class="card-header">
                <h3 class="mb-0">
                    <i class="bi bi-bank me-2"></i>
                    Selecciona los Bancos a Comparar
                </h3>
            </div>
            <div class="card-body">
                <div class="bank-options">
                    <div class="select-all-option" onclick="selectAllBanks()">
                        <i class="bi bi-check-all me-2"></i>
                        Seleccionar Todos los Bancos
                    </div>
                    
                    {% for bank_key, bank in banks.items() %}
                    <div class="bank-option">
                        <input type="checkbox" name="selected_banks" value="{{ bank_key }}" id="bank_{{ bank_key }}" checked>
                        <i class="{{ bank.icon }} me-2"></i>
                        <div>
                            <div class="fw-bold">{{ bank.name }}</div>
                            <div class="small text-muted">
                                {{ "%.2f"|format(bank.rates.min) }}% - {{ "%.2f"|format(bank.rates.max) }}%
                                {% if bank.campaign_rate %}
                                    | 🎯 {{ "%.2f"|format(bank.campaign_rate) }}% ({{ bank.campaign_description }})
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Calculate Button -->
        <div class="text-center my-4">
            <button type="button" class="btn btn-primary btn-lg" onclick="calculatePortfolio()">
                <i class="bi bi-calculator me-2"></i>
                Calcular Ahorro Potencial
            </button>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="d-none">
            <div id="resultsContainer"></div>
        </div>

        <!-- Important Information -->
        <div class="info-important">
            <div class="row">
                <div class="col-lg-8">
                    <h5><i class="bi bi-info-circle me-2"></i>Información Importante</h5>
                    <p class="mb-3">
                        <strong>¿Cómo funciona el cálculo?</strong> El simulador compara lo que pagarías con tu tasa actual versus las nuevas ofertas de otros bancos, 
                        usando tu saldo pendiente. Si ya pagaste gran parte del capital, es normal que la diferencia en cuotas sea menor, 
                        pero el ahorro total real sigue siendo significativo.
                    </p>
                    <p class="mb-3">
                        Esta simulación es referencial. Los resultados pueden variar según las condiciones específicas de cada banco, 
                        evaluación crediticia del cliente y políticas vigentes. Las tasas de interés están sujetas a cambios sin previo aviso.
                        Las tarifas de los seguros pueden cambiar según la entidad financiera seleccionada.
                    </p>
                    <p class="mb-0">
                        <strong>Para obtener información exacta y actualizada, consulta a tu asesor Agile Home.</strong>
                    </p>
                </div>
                <div class="col-lg-4 text-lg-end">
                    <button class="btn btn-success whatsapp-btn" onclick="contactWhatsApp()">
                        <i class="bi bi-whatsapp me-2"></i>
                        Contactar Asesor
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-lg-8">
                    <h5>Agile Home</h5>
                    <p>Tu aliado en el camino hacia la casa de tus sueños. Expertos en soluciones hipotecarias con las mejores tasas del mercado.</p>
                    <ul class="list-unstyled">
                        <li>✓ Asesoría personalizada sin costo</li>
                        <li>✓ Comparación de ofertas de múltiples bancos</li>
                        <li>✓ Acompañamiento en todo el proceso</li>
                        <li>✓ Tramitación rápida y segura</li>
                    </ul>
                </div>
                <div class="col-lg-4">
                    <h5>Contacto</h5>
                    <p>¿Necesitas ayuda personalizada?</p>
                    <button class="btn btn-outline-light" onclick="contactWhatsApp()">
                        <i class="bi bi-whatsapp me-2"></i>
                        Hablar con un Asesor
                    </button>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="{{ url_for('static', filename='js/calculator.js') }}"></script>
</body>
</html>
